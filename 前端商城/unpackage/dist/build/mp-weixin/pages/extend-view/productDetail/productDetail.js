(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/extend-view/productDetail/productDetail"],{"159d":function(t,n,e){"use strict";(function(t){e("c96d"),e("921b");i(e("66fd"));var n=i(e("1ec0"));function i(t){return t&&t.__esModule?t:{default:t}}t(n.default)}).call(this,e("543d")["createPage"])},"1ec0":function(t,n,e){"use strict";e.r(n);var i=e("caf2"),o=e("af5e");for(var s in o)"default"!==s&&function(t){e.d(n,t,function(){return o[t]})}(s);e("4aca");var a=e("2877"),u=Object(a["a"])(o["default"],i["a"],i["b"],!1,null,null,null);n["default"]=u.exports},"46de":function(t,n,e){"use strict";(function(t){function i(t,n){return a(t)||s(t,n)||o()}function o(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function s(t,n){var e=[],i=!0,o=!1,s=void 0;try{for(var a,u=t[Symbol.iterator]();!(i=(a=u.next()).done);i=!0)if(e.push(a.value),n&&e.length===n)break}catch(r){o=!0,s=r}finally{try{i||null==u["return"]||u["return"]()}finally{if(o)throw s}}return e}function a(t){if(Array.isArray(t))return t}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var u=function(){return e.e("components/uni/uni-countdown/uni-countdown").then(e.bind(null,"aa98"))},r=function(){return e.e("components/icon/icon").then(e.bind(null,"f8d3"))},c=function(){return e.e("components/tag/tag").then(e.bind(null,"a960"))},l=function(){return e.e("components/badge/badge").then(e.bind(null,"cf17"))},h=function(){return e.e("components/nomore/nomore").then(e.bind(null,"1a8d"))},d=function(){return e.e("components/button/button").then(e.bind(null,"9473"))},p=function(){return e.e("components/top-dropdown/top-dropdown").then(e.bind(null,"bb70"))},f=function(){return e.e("components/bottom-popup/bottom-popup").then(e.bind(null,"ef80"))},g=function(){return e.e("components/numberbox/numberbox").then(e.bind(null,"ef9c"))},m=function(){return e.e("components/hch-poster/hch-poster").then(e.bind(null,"120d"))},_={components:{tuiIcon:r,tuiTag:c,tuiBadge:l,tuiNomore:h,tuiButton:d,tuiTopDropdown:p,tuiBottomPopup:f,tuiNumberbox:g,uniCountdown:u,hchPoster:m},data:function(){return{discount_start:0,discount_time:{days:"",hours:"",minutes:"",seconds:""},end_time:"",canvasFlag:!0,posterData:{},content:"",xz_sku_name:"",price:"",x:0,sku_index:"",num:1,getimg:this.$getimg,is_vip:0,shop_car_num:"",vid:0,sku_arr:"",poster:{},qrShow:!1,is_share:!1,detail:!0,couponList:[],maskState:0,height:64,top:0,scrollH:0,opcity:0,iconOpcity:.5,banner:{url:"http://www.thorui.cn/img/product/11.jpg",url1:"http://www.thorui.cn/img/product/33.jpg"},bannerIndex:0,menuShow:!1,popupShow:!1,goods_num:1,id:"",list:{},applist:[],collected:"",detailData:"",shareList:""}},onLoad:function(n){var e=this;this.id=n.id,this.is_like(n.id),this._load();var i=t.getStorageSync("cart");if(i){var o=Object.entries(i).length;this.shop_car_num=o}else this.shop_car_num=0;var s={};s=wx.getMenuButtonBoundingClientRect(),t.getSystemInfo({success:function(t){e.width=s.left||t.windowWidth,e.height=s.top?s.top+s.height+8:t.statusBarHeight+44,e.top=s.top?s.top+(s.height-32)/2:t.statusBarHeight+6,e.scrollH=t.windowWidth}})},methods:{shareFc:function(){var t=this;console.log("生成海报"),Object.assign(this.posterData,{url:this.getimg+this.list.imgs,icon:"https://img0.zuipin.cn/mp_zuipin/poster/hch-hyj.png",title:this.list.goods_name,discountPrice:this.list.price,orignPrice:this.list.market_price,code:"https://img0.zuipin.cn/mp_zuipin/poster/hch-code.png"}),this.$forceUpdate(),setTimeout(function(){t.canvasFlag=!1,t.is_share=!1,t.$refs.hchPoster.createCanvasImage()},500)},_load:function(){var t=this;this.$api.http.get("product/get_product?id=",{id:this.id}).then(function(n){if(t.detail=!n.data.discount.id,t.price=n.data.price,t.list=n.data,t.list.discount.discount){var e=t.list.discount.discount.end_time,o=(new Date).getTime(),s=new Date(e).getTime();if(s>o)var a=s-o,u=(Math.floor(a/864e5),s-o),r=Math.floor(u/864e5),c=u%864e5,l=Math.floor(c/36e5),h=c%36e5,d=Math.floor(h/6e4),p=h%6e4,f=Math.round(p/1e3);t.discount_time.days=r,t.discount_time.hours=l,t.discount_time.minutes=d,t.discount_time.seconds=f;var g=t.list.discount.discount.start_time,m=new Date(g).getTime(),_=o;console.log("当前时间",_),console.log("开始时间",m),_>m?(t.discount_start=1,console.log("活动已开启")):(t.discount_start=0,console.log("活动还未开始"))}var v=new RegExp('style=""',"gi");n.data.content=n.data.content.replace(v,"");var k=new RegExp("<img","gi");if(t.content=n.data.content.replace(k,'<img style="max-width: 100%; height: auto"'),t.list.sku_arr&&(t.sku_arr=t.list.sku_arr,t.xz_sku_name="请选择规格"),n.data.sku.length>0){n.data.sku_arr.initialSku={},n.data.sku_arr.initialSku["selectedNum"]=1;for(var b=Object.entries(n.data.sku_arr.tree),w=0;w<b.length;w++){var S=i(b[w],2),y=(S[0],S[1]);n.data.sku_arr.initialSku[y.k_s]=""}}}),this.$api.http.get("product/get_evaluate?id=",{id:this.id}).then(function(n){t.applist=n.data[0],console.log(t.applist)}),this.$api.http.get("coupon/get_coupon").then(function(n){t.couponList=n.data,console.log(t.couponList)})},canvasCancel:function(t){this.canvasFlag=t},sku_change_num:function(t){console.log("num:",t.value);var n=t.value,e=this.list;e.sku.length>0?e.sku_arr.initialSku.selectedNum=n:(e.sku_arr.initialSku={},e.sku_arr.initialSku.selectedNum=n),console.log("num2:",n),this.list=e,this.num=n},change_sku_img:function(t){var n=this.list.sku_arr.tree[0].v;console.log("sku_img",n);for(var e=Object.entries(n),o=0;o<e.length;o++){var s=i(e[o],2),a=(s[0],s[1]);console.log("sku_img_v",a),t==a.id&&a.imgUrl&&(this.list.imgs=a.imgUrl)}},xz_sku_cs:function(t,n){var e=this.list,o=e.sku_arr.initialSku;o[t]=n,this.change_sku_img(n);for(var s=Object.keys(o).length-1,a=e.price,u=e.stock,r="",c=-1,l=Object.entries(e.sku_arr.list),h=0;h<l.length;h++){var d=i(l[h],2),p=d[0],f=d[1];1==s&&o["s1"]==f["s1"]&&(a=f.price,u=f.stock_num,r=f["s1_name"],c=p),2==s&&o["s1"]==f["s1"]&&o["s2"]==f["s2"]&&(a=f.price,u=f.stock_num,r=f["s1_name"]+" "+f["s2_name"],c=p),3==s&&o["s1"]==f["s1"]&&o["s2"]==f["s2"]&&o["s3"]==f["s3"]&&(a=f.price,u=f.stock_num,r=f["s1_name"]+" "+f["s2_name"]+" "+f["s3_name"],c=p)}e.price=a,e.stock=u,e.sku_name=r,this.xz_sku_name=e.sku_name,this.list=e,this.sku_index=c,this.x++,console.log("sku_index:",c)},add_cart:function(){var n=this;if(this.check_sku()){var e=this.sku_index,o=this.list.goods_id;e>=0&&(o=o+"-"+e),console.log("cache",o,e);var s={},a=t.getStorageSync("cart"),u=Object.keys(a).length;if(u>0){for(var r=Object.entries(a),c=0;c<r.length;c++){var l=i(r[c],2),h=l[0];l[1];if(o==h)return void n.$api.msg("已存在")}a[o]=this._setOrderData(),t.setStorageSync("cart",a),this.shop_car_num++}else s[o]=this._setOrderData(),t.setStorageSync("cart",s),this.shop_car_num=1;n.$api.msg("加入成功"),this.popupShow=!1}},add_shopping:function(){if(this.check_sku()){console.log("add_shopping");var n=this._setOrderData();if(n){n["goods_id"];t.setStorageSync("buy",{0:n}),t.redirectTo({url:"/pages/order/createOrder?state=buy"})}}},check_sku:function(){console.log("check_sku");var t=this;if(this.list.sku.length<1)return!0;for(var n=this.list.sku_arr.initialSku,e=Object.entries(n),o=0;o<e.length;o++){var s=i(e[o],2),a=(s[0],s[1]);if(""==a)return t.$api.msg("未选择规格"),!1}return!0},_setOrderData:function(){var t=this,n=this.sku_index,e=this.list;if(0!=e.stock){var i={};return i["goods_id"]=e.goods_id,i["goods_name"]=e.goods_name,i["shopping_fee"]=e.shipping_fee,i["radio"]=!0,i["imgs"]=e.imgs?e.imgs:"",i["price"]=e.price,i["num"]=this.num,i["stock"]=e.stock,e.sku.length>0&&(i["num"]=e.sku_arr.initialSku.selectedNum,i["sku"]=e.sku_arr.list[n],i["sku_name"]=e.sku_name),i}t.$api.msg("库存不足")},is_like:function(t){var n=this;this.$api.http.post("favorite/get_one_fav",{id:t}).then(function(t){t.data?n.collected=!0:n.collected=!1})},lq_coupon:function(t){var n=this;this.$api.http.get("coupon/add_coupon",{id:t}).then(function(t){200==t.status&&n.$api.msg("领取成功"),400==t.status&&n.$api.msg(t.msg)})},toggleMask:function(t){var n=this,e="show"===t?10:300,i="show"===t?1:0;this.maskState=2,setTimeout(function(){n.maskState=i},e)},jump_tohome:function(){t.switchTab({url:"/pages/index/index"})},jump_to:function(){t.setStorageSync("buy",this.list),t.navigateTo({url:"../../order/createOrder?state=buy"})},jump_toshop:function(){t.navigateTo({url:"../../shop/shop"})},jump_toevaluate:function(n){t.navigateTo({url:"../../evaluate/evaluate?id="+n})},jump_tocart:function(){t.switchTab({url:"../../cart/cart"})},bannerChange:function(t){this.bannerIndex=t.detail.current},previewImage:function(n){var e=n.currentTarget.dataset.index;t.previewImage({current:this.banner[e],urls:this.banner})},back:function(){t.navigateBack()},openMenu:function(){this.menuShow=!0},closeMenu:function(){this.menuShow=!1},showPopup:function(){this.popupShow=!0},hidePopup:function(){this.popupShow=!1},change:function(t){this.value=t.value},collecting:function(){var t=this;if(this.collected)this.$api.http.put("favorite/del_fav",{id:this.id}).then(function(n){t.$api.msg("取消收藏")});else{var n={fav_id:this.id,type:"goods",price:this.list.price};this.$api.http.post("favorite/add_fav",n).then(function(n){t.$api.msg("收藏成功")})}this.collected=!this.collected}},onPageScroll:function(t){var n=t.scrollTop<=0?0:t.scrollTop,e=n/this.scrollH;this.opcity>=1&&e>=1||(this.opcity=e,this.iconOpcity=.5*(1-e<0?0:1-e))},onShareAppMessage:function(t){return{title:"如花"}},onPullDownRefresh:function(){this._load(),setTimeout(function(){t.stopPullDownRefresh()},2e3)}};n.default=_}).call(this,e("543d")["default"])},"4aca":function(t,n,e){"use strict";var i=e("4e8a"),o=e.n(i);o.a},"4e8a":function(t,n,e){},af5e:function(t,n,e){"use strict";e.r(n);var i=e("46de"),o=e.n(i);for(var s in i)"default"!==s&&function(t){e.d(n,t,function(){return i[t]})}(s);n["default"]=o.a},caf2:function(t,n,e){"use strict";var i=function(){var t=this,n=t.$createElement,i=(t._self._c,e("7f00")),o=e("fdfa");t._isMounted||(t.e0=function(n){t.is_share=!0},t.e1=function(n){t.is_share=!1},t.e2=function(n){t.is_share=!1}),t.$mp.data=Object.assign({},{$root:{m0:i,m1:o}})},o=[];e.d(n,"a",function(){return i}),e.d(n,"b",function(){return o})}},[["159d","common/runtime","common/vendor"]]]);